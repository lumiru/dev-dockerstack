FROM easycom/java:default
MAINTAINER Nicolas GAUTIER <ngautier@enroot.fr>

## ================================
## CONFIGURATION SOFTWARE PART
## ================================
# ==> PhpStorm URL (tgz file)
ENV PHPSTORM_URL http://download.jetbrains.com/webide/PhpStorm-8.0.1.tar.gz

## ================================
## CONFIGURATION USER PART
## ================================
ENV USER_ID 1000
ENV GROUP_ID 1000
ENV USER_NAME developer
ENV USER_TITLE Developer

## ================================
## INSTALLATION PART
## ================================
# Copy, change rights, execute, delete script file "install.sh"
ADD ./install.sh /install.sh
RUN chmod 755 /install.sh
RUN /install.sh
RUN rm -f /install.sh

# Copy, change rights "run.sh"
ADD ./run.sh /run.sh
RUN chmod 755 /run.sh

## ============================================
## CREATE AN USER + WORKSPACE + SUDO rights
## ============================================

RUN export uid=$USER_ID gid=$GROUP_ID && \
    mkdir -p /home/$USER_NAME && \
    echo "$USER_NAME:x:${uid}:${gid}:$USER_TITLE,,,:/home/$USER_NAME:/bin/bash" >> /etc/passwd && \
    echo "$USER_NAME:x:${uid}:" >> /etc/group && \
    echo "$USER_NAME ALL=(ALL) NOPASSWD: ALL" > /etc/sudoers.d/$USER_NAME && \
    chmod 0440 /etc/sudoers.d/$USER_NAME && \
    chown ${uid}:${gid} -R /home/$USER_NAME

USER root

## ================================
## LAUNCH PART
## ================================
# Expose sockets

# Launch run script
CMD /run.sh